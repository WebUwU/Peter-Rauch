<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Peter Rauch – Auswahl</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <div class="card-container">
      <div class="card" id="card-bio" onclick="showContent('bio')">
        <div class="img-holder">
          <img src="img/autobiografie.png" alt="Autobiografie">
        </div>
        <h2>Autobiografie</h2>
        <p>„Von der Gosse auf die Insel"</p>
      </div>
      <div class="card" id="card-lounge" onclick="showContent('lounge')">
        <div class="img-holder">
          <img src="img/lounge.png" alt="Lounge">
        </div>
        <h2>Rauchs Lounge</h2>
        <p>„Treffpunkt, Infos & mehr“</p>
      </div>
    </div>

    <!-- Musikplayer: modern, mittig, autoplay -->
    <div class="music-player" id="music-player">
      <audio id="audio-player" src="music/music.mp3" preload="auto"></audio>
      <button id="play-btn" title="Play/Pause">▶️</button>
      <input type="range" id="seek-bar" min="0" value="0" step="1">
      <span id="current-time">00:00</span> / <span id="duration">00:00</span>
      <input type="range" min="0" max="1" step="0.01" value="0.6" id="volume-slider" title="Lautstärke">
      <span id="volume-icon">🔊</span>
    </div>

    <div class="big-content" id="big-bio" style="display:none;">
      <button class="close-btn" onclick="closeContent()">✕</button>
      <div class="popup-block">
        <h2>Autobiografie</h2>
        <div class="big-text" id="bio-text">Lädt...</div>
      </div>
    </div>
    <div class="big-content" id="big-lounge" style="display:none;">
      <button class="close-btn" onclick="closeContent()">✕</button>
      <div class="popup-block">
        <h2>Lounge</h2>
        <div class="pdf-download">
          <a href="files/vertrag.pdf" download>📄 Vertrag herunterladen</a>
        </div>
        <div class="big-text" id="lounge-text">Lädt...</div>
      </div>
    </div>
  </main>
  <script>
    // --- POPUP TEXT RICHTIG FORMATIEREN ---
    function showContent(which) {
      document.body.style.overflow = "hidden"; // Popup: Body-Scroll verhindern
      document.getElementById('big-bio').style.display = 'none';
      document.getElementById('big-lounge').style.display = 'none';
      if (which === 'bio') {
        document.getElementById('big-bio').style.display = 'flex';
        fetch('bio.txt').then(r=>r.text()).then(t=>{
          document.getElementById('bio-text').innerHTML =
            t.split(/\n\s*\n/).map(paragraph =>
              `<p>${paragraph.replace(/\n/g, '<br>')}</p>`
            ).join('');
        }).catch(()=>{document.getElementById('bio-text').innerHTML = "Fehler beim Laden."});
      } else if (which === 'lounge') {
        document.getElementById('big-lounge').style.display = 'flex';
        fetch('lounge.txt').then(r=>r.text()).then(t=>{
          document.getElementById('lounge-text').innerHTML =
            t.split(/\n\s*\n/).map(paragraph =>
              `<p>${paragraph.replace(/\n/g, '<br>')}</p>`
            ).join('');
        }).catch(()=>{document.getElementById('lounge-text').innerHTML = "Fehler beim Laden."});
      }
    }
    function closeContent() {
      document.getElementById('big-bio').style.display = 'none';
      document.getElementById('big-lounge').style.display = 'none';
      document.body.style.overflow = ""; // Body wieder scrollbar
    }

    // --- MUSIKPLAYER ---
    const audio = document.getElementById('audio-player');
    const playBtn = document.getElementById('play-btn');
    const seekBar = document.getElementById('seek-bar');
    const currentTime = document.getElementById('current-time');
    const duration = document.getElementById('duration');
    const volumeSlider = document.getElementById('volume-slider');
    const volumeIcon = document.getElementById('volume-icon');

    let isPlaying = false;

    // Dauer immer wieder abfragen bis sie stimmt
    function fixDuration() {
      if (audio.duration && !isNaN(audio.duration) && audio.duration > 0) {
        seekBar.max = Math.floor(audio.duration);
        duration.textContent = formatTime(audio.duration);
      } else {
        duration.textContent = "00:00";
        setTimeout(fixDuration, 200);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        audio.volume = volumeSlider.value;
        audio.play().catch(()=>{});
      }, 600);
    });

    playBtn.addEventListener('click', () => {
      if(audio.paused) { audio.play(); }
      else { audio.pause(); }
    });

    audio.addEventListener('play', () => {
      playBtn.textContent = '⏸️';
      isPlaying = true;
    });
    audio.addEventListener('pause', () => {
      playBtn.textContent = '▶️';
      isPlaying = false;
    });

    // Seekbar + Zeit
    audio.addEventListener('loadedmetadata', fixDuration);
    audio.addEventListener('durationchange', fixDuration);
    audio.addEventListener('timeupdate', () => {
      seekBar.value = Math.floor(audio.currentTime);
      currentTime.textContent = formatTime(audio.currentTime);
    });
    seekBar.addEventListener('input', () => {
      audio.currentTime = seekBar.value;
    });

    // Volume
    volumeSlider.addEventListener('input', function() {
      audio.volume = this.value;
      if(audio.volume == 0) volumeIcon.textContent = '🔈';
      else if(audio.volume < 0.5) volumeIcon.textContent = '🔉';
      else volumeIcon.textContent = '🔊';
    });

    function formatTime(sec) {
      if (!sec || isNaN(sec) || sec === Infinity) return "00:00";
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }
  </script>
</body>
</html>
